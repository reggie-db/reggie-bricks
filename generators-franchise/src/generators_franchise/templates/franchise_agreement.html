{# Incoming map of extra generated text per section number. Keys are integers 1..N. Values are lists of strings. #}
{% set generated_by_secno = generated_by_secno|default({}) %}

{# Control the order of sections by setting sections_order in your context.
The section numbers shown in the document are 1-based and follow this order. #}
{% set sections_order = sections_order|default([
"cover",
"recitals",
"grant",
"term_and_renewal",
"fees",
"operating_standards",
"training_qc",
"insurance_indemnity",
"confidentiality",
"termination",
"post_termination",
"dispute_resolution",
"miscellaneous",
"signatures"
]) %}

<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>{{ brand_name }} Franchise Agreement</title>
    <style>
        @page {
            size: Letter;
            margin: 1in;
        }

        body {
            font-family: Georgia, "Times New Roman", serif;
            color: #222;
            line-height: 1.35;
            font-size: 12pt;
            counter-reset: section;
        }

        header,
        footer {
            position: fixed;
            left: 0;
            right: 0;
            color: #666;
            font-size: 10pt;
        }

        header {
            top: 0.5cm;
            text-align: right;
            padding-right: 0.75cm;
        }

        footer {
            bottom: 0.5cm;
            text-align: center;
        }

        .pagenum:before {
            content: counter(page);
        }

        h1,
        h2 {
            font-weight: 700;
            margin: 0.5em 0 0.25em 0;
        }

        h1 {
            text-align: center;
            font-size: 18pt;
            letter-spacing: 0.5px;
        }

        h2 {
            font-size: 13.5pt;
            counter-increment: section;
        }

        h2 .secno::before {
            content: counter(section) ". ";
            font-weight: 700;
            margin-right: 2px;
        }

        .subtitle {
            text-align: center;
            color: #444;
            margin-bottom: 1.2em;
        }

        .small {
            font-size: 10pt;
            color: #555;
        }

        .mt {
            margin-top: 1em;
        }

        .mb {
            margin-bottom: 1em;
        }

        .spacer {
            height: 0.75em;
        }

        .box {
            border: 1px solid #bbb;
            padding: 0.6em 0.8em;
            background: #fafafa;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 0.4rem 0.8rem;
            margin: 0.5em 0;
        }

        .label {
            color: #555;
        }

        .value {
            font-weight: 600;
        }

        .page-break {
            page-break-before: always;
        }

        .gen {
            margin: 0.6em 0;
        }
    </style>
</head>

<body>

    <header>{{ brand_name }} Franchise Agreement</header>
    <footer>Page <span class="pagenum"></span></footer>

    {# Helper to render any generated text attached to this section number #}
    {% macro render_generated(secno) -%}
    {%- set items = generated_by_secno.get(secno, []) -%}
    {%- if items and items|length > 0 -%}
    {%- for t in items -%}
    <p class="gen">{{ t|e }}</p>
    {%- endfor -%}
    {%- endif -%}
    {%- endmacro %}

    {# =========================
    Section Macros
    Each macro accepts secno and appends render_generated(secno)
    ========================= #}
    {% macro cover(secno) %}
    <h1>{{ brand_name }} Franchise Agreement</h1>
    <div class="subtitle">{{ franchisor_name }} and {{ franchisee_company }}</div>

    <div class="box">
        <div class="grid">
            <div class="label">Franchisor</div>
            <div class="value">{{ franchisor_name }}</div>
            <div class="label">Brand</div>
            <div class="value">{{ brand_name }}</div>
            <div class="label">Franchisee</div>
            <div class="value">{{ franchisee_company }}</div>
            <div class="label">Authorized Signer</div>
            <div class="value">{{ authorized_signer }}</div>
            <div class="label">Execution Date</div>
            <div class="value">{{ execution_date }}</div>
            <div class="label">Address</div>
            <div class="value">{{ address }}</div>
            <div class="label">Email</div>
            <div class="value">{{ email }}</div>
            <div class="label">Phone</div>
            <div class="value">{{ phone }}</div>
        </div>
    </div>

    <div class="mt small">This agreement memorializes the relationship between the franchisor and the franchisee with
        respect to the operation of a restaurant under the brand system. The parties intend that this document state
        their entire understanding subject to applicable law.</div>

    {{ render_generated(secno) }}
    <div class="page-break"></div>
    {% endmacro %}

    {% macro recitals(secno) %}
    <h2><span class="secno"></span>Recitals</h2>
    <p>The franchisor owns valuable trademarks service marks trade dress proprietary methods and operating systems
        associated with the brand. The franchisee desires to obtain and the franchisor agrees to grant a limited license
        to operate a restaurant under the brand system on the terms of this agreement.</p>
    <p>The franchisee represents that it has reviewed the disclosure materials and possesses the financial and
        managerial capacity to operate the restaurant in accordance with brand standards and the operations manual.</p>
    {{ render_generated(secno) }}
    {% endmacro %}

    {% macro grant(secno) %}
    <h2><span class="secno"></span>Grant of Franchise</h2>
    <p>The franchisor grants to the franchisee a limited non exclusive non transferable license to operate a single
        restaurant using the brand system and marks at a location approved by the franchisor. No territorial exclusivity
        is granted unless expressly stated in a written schedule.</p>
    <p>The franchisee acknowledges that all right title and interest in and to the marks and system remain solely with
        the franchisor and that all goodwill arising from their use inures to the benefit of the franchisor.</p>
    {{ render_generated(secno) }}
    {% endmacro %}

    {% macro term_and_renewal(secno) %}
    <h2><span class="secno"></span>Term and Renewal</h2>
    <p>The initial term commences on the execution date and continues for {{ term_years }} years unless earlier
        terminated as provided herein. Renewal is available at the franchisor election subject to then current criteria
        including compliance with the agreement completion of required refurbishments and payment of renewal fees.</p>
    {{ render_generated(secno) }}
    {% endmacro %}

    {% macro fees(secno) %}
    <h2><span class="secno"></span>Fees and Payments</h2>
    <p>The franchisee shall pay an initial franchise fee of {{ currency }} {{ initial_fee }} which is fully earned upon
        execution. During the term the franchisee shall pay a continuing royalty equal to {{ royalty_pct }} percent of
        gross sales and an advertising fund contribution equal to {{ ad_fund_pct }} percent of gross sales as further
        described in the operations manual.</p>
    <p>All payments are due at the intervals specified by the franchisor and are non refundable except as expressly set
        forth in a schedule signed by both parties.</p>
    {{ render_generated(secno) }}
    {% endmacro %}

    {% macro operating_standards(secno) %}
    <h2><span class="secno"></span>Operating Standards</h2>
    <p>The franchisee shall operate the restaurant strictly in accordance with the operations manual and brand standards
        which the franchisor may update from time to time. The franchisee shall maintain product quality cleanliness
        speed of service and guest experience at levels consistent with the brand system.</p>
    <p>The franchisor may inspect the restaurant and require reasonable corrective actions within stated time frames.
    </p>
    {{ render_generated(secno) }}
    {% endmacro %}

    {% macro training_qc(secno) %}
    <h2><span class="secno"></span>Training and Quality Control</h2>
    <p>The franchisor will provide initial training materials and periodic updates. The franchisee shall ensure that
        managers and staff complete all required training and certifications and shall maintain accurate training
        records available for review by the franchisor.</p>
    {{ render_generated(secno) }}
    {% endmacro %}

    {% macro insurance_indemnity(secno) %}
    <h2><span class="secno"></span>Insurance and Indemnity</h2>
    <p>The franchisee shall procure and maintain insurance coverage in types and amounts specified by the franchisor
        naming the franchisor as additional insured where applicable. Certificates of insurance shall be provided upon
        request.</p>
    <p>The franchisee shall indemnify and hold the franchisor and its affiliates harmless from claims losses and
        expenses arising out of the operation of the restaurant except to the extent caused by the gross negligence or
        willful misconduct of the franchisor.</p>
    {{ render_generated(secno) }}
    {% endmacro %}

    {% macro confidentiality(secno) %}
    <h2><span class="secno"></span>Confidentiality</h2>
    <p>All information designated confidential including without limitation the operations manual product specifications
        supplier information and business methods shall be kept confidential by the franchisee and used only in the
        operation of the restaurant. Upon termination or expiration the franchisee shall return or destroy confidential
        materials as directed by the franchisor.</p>
    {{ render_generated(secno) }}
    {% endmacro %}

    {% macro termination(secno) %}
    <h2><span class="secno"></span>Termination</h2>
    <p>Either party may terminate this agreement upon a material breach that remains uncured after written notice and a
        reasonable cure period. Immediate termination may be effected for causes defined in the operations manual or
        applicable law including abandonment misuse of the marks or criminal activity at the restaurant.</p>
    {{ render_generated(secno) }}
    {% endmacro %}

    {% macro post_termination(secno) %}
    <h2><span class="secno"></span>Post Termination Obligations</h2>
    <p>Upon termination or expiration the franchisee shall immediately cease all use of the marks and system remove
        signage and trade dress and comply with de branding requirements. Certain covenants including confidentiality
        return of materials and non disparagement shall survive as stated herein.</p>
    {{ render_generated(secno) }}
    {% endmacro %}

    {% macro dispute_resolution(secno) %}
    <h2><span class="secno"></span>Dispute Resolution</h2>
    <p>The parties shall first engage in good faith discussions to resolve disputes followed by mediation. If unresolved
        the matter shall be submitted to binding arbitration administered by the American Arbitration Association in {{
        venue_county }}, {{ governing_state }}. Judgment on the award may be entered in any court of competent
        jurisdiction.</p>
    <p>This agreement is governed by the laws of the State of {{ governing_state }} without regard to conflict of law
        rules.</p>
    {{ render_generated(secno) }}
    {% endmacro %}

    {% macro miscellaneous(secno) %}
    <h2><span class="secno"></span>Miscellaneous Provisions</h2>
    <p>This agreement together with schedules referenced herein constitutes the entire agreement of the parties and
        supersedes prior understandings. Amendments must be in a signed writing. If any provision is held invalid the
        remaining provisions shall remain in full force to the maximum extent permitted by law.</p>
    <p>Notices shall be effective upon receipt at the addresses stated on the cover page. Either party may update its
        notice address by written notice to the other party.</p>
    {{ render_generated(secno) }}
    {% endmacro %}

    {% macro signatures(secno) %}
    <div class="page-break"></div>
    <h2><span class="secno"></span>Execution and Signatures</h2>
    <p>In witness whereof the parties have executed this agreement as of the execution date stated above.</p>

    <div class="mt mb">
        <div class="box">
            <strong>Franchisee</strong><br />
            {{ franchisee_company }}<br /><br />
            By: <i>{% raw %}~{% endraw %}{{ authorized_signer }}{% raw %}~{% endraw %}</i><br />
            Name: {{ authorized_signer }}<br />
            Title: Authorized Representative<br />
            Date: {{ execution_date }}
        </div>
    </div>

    <div class="mt">
        <div class="box">
            <strong>Franchisor</strong><br />
            {{ franchisor_name }}<br /><br />
            By: <i>{% raw %}~{% endraw %}{{ franchisor_authorized_signer }}{% raw %}~{% endraw %}</i><br />
            Name: {{ franchisor_authorized_signer }}<br />
            Title: Regional Director<br />
            Date: {{ franchise_execution_date }}
        </div>
    </div>
    {{ render_generated(secno) }}
    {% endmacro %}

    {# =========================
    Render in requested order
    Pass the 1-based section number into each macro so it can look up generated_by_secno[secno]
    ========================= #}
    {% for s in sections_order %}
    {% set secno = loop.index %}
    {% if s == "cover" %}{{ cover(secno) }}
    {% elif s == "recitals" %}{{ recitals(secno) }}
    {% elif s == "grant" %}{{ grant(secno) }}
    {% elif s == "term_and_renewal" %}{{ term_and_renewal(secno) }}
    {% elif s == "fees" %}{{ fees(secno) }}
    {% elif s == "operating_standards" %}{{ operating_standards(secno) }}
    {% elif s == "training_qc" %}{{ training_qc(secno) }}
    {% elif s == "insurance_indemnity" %}{{ insurance_indemnity(secno) }}
    {% elif s == "confidentiality" %}{{ confidentiality(secno) }}
    {% elif s == "termination" %}{{ termination(secno) }}
    {% elif s == "post_termination" %}{{ post_termination(secno) }}
    {% elif s == "dispute_resolution" %}{{ dispute_resolution(secno) }}
    {% elif s == "miscellaneous" %}{{ miscellaneous(secno) }}
    {% elif s == "signatures" %}{{ signatures(secno) }}
    {% endif %}
    {% endfor %}

</body>

</html>